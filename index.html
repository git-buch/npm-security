<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bilder Datenbank</title>
  <style>
    button {
      margin: 2em;
    }
  </style>
</head>
<body>
  <h1>Bilder Datenbank</h1>
  <form method="POST" action="/api/picture" enctype="multipart/form-data">
    <input type="file" name="file">
    <input type="submit" value="hochladen">
  </form>
  <ul id="pics"></ul>
  <script>
    function fetchPics() {
      fetch('/api/pictures')
        .then(data => data.json())
        .then(pics => {
          const ul = document.querySelector('#pics');
          while (ul.firstChild) {
            ul.removeChild(ul.firstChild);
          }
          for (let pic of pics.data) {
            let li = document.createElement("li");
            let img = document.createElement("img");
            img.src = `data:${pic.mime};base64,${btoa(String.fromCharCode.apply(null,pic.thumbnail.data))}`;
            let deleteButton = document.createElement("button");
            deleteButton.onclick = function() {
              fetch(`/api/picture/${pic.id}`, { method: 'DELETE'})
                .then(data => fetchPics());
            };
            deleteButton.innerHTML = 'LÃ¶schen';
            li.appendChild(img);
            li.appendChild(deleteButton);
            ul.appendChild(li);
          }
        });
    }
    fetchPics();
  </script>
</body>
</html>